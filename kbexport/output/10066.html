<h1>Database size seems too big</h1><h2>10066</h2><h3>Introduction</h3><p>The EncounterPRO 4.0 database sometimes seems to grow faster than expected.</p><h3>Symptom</h3><p><p>For a high volume primary care practice, the EncounterPRO Database is expected to grow at approximately the following rate:</p><p><table class="MsoTableGrid" style="border: medium none ; width: 419.4pt; border-collapse: collapse;" border="1" cellpadding="0" cellspacing="0" width="559"><tbody><tr style=""><td style="border: 1pt solid windowtext; padding: 0in 5.4pt; width: 244.85pt; background-color: transparent;" valign="top" width="326"><p class="MsoNormal" style="margin: 0in 0in 0pt;"><b style="">Type of Data<o:p></o:p></b></p></td><td style="border-style: solid solid solid none; border-color: windowtext windowtext windowtext rgb(212, 208, 200); border-width: 1pt 1pt 1pt medium; padding: 0in 5.4pt; width: 174.55pt; background-color: transparent;" valign="top" width="233"><p class="MsoNormal" style="margin: 0in 0in 0pt;"><b style="">Growth per Physician per year<o:p></o:p></b></p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: rgb(212, 208, 200) windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 244.85pt; background-color: transparent;" valign="top" width="326"><p class="MsoNormal" style="margin: 0in 0in 0pt;">Structured Data (not including workflow logs)</p></td><td style="border-style: none solid solid none; border-color: rgb(212, 208, 200) windowtext windowtext rgb(212, 208, 200); border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 174.55pt; background-color: transparent;" valign="top" width="233"><p class="MsoNormal" style="margin: 0in 0in 0pt;">450M</p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: rgb(212, 208, 200) windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 244.85pt; background-color: transparent;" valign="top" width="326"><p class="MsoNormal" style="margin: 0in 0in 0pt;">Workflow Logs</p></td><td style="border-style: none solid solid none; border-color: rgb(212, 208, 200) windowtext windowtext rgb(212, 208, 200); border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 174.55pt; background-color: transparent;" valign="top" width="233"><p class="MsoNormal" style="margin: 0in 0in 0pt;">700M</p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: rgb(212, 208, 200) windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 244.85pt; background-color: transparent;" valign="top" width="326"><p class="MsoNormal" style="margin: 0in 0in 0pt;">Attachments</p></td><td style="border-style: none solid solid none; border-color: rgb(212, 208, 200) windowtext windowtext rgb(212, 208, 200); border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 174.55pt; background-color: transparent;" valign="top" width="233"><p class="MsoNormal" style="margin: 0in 0in 0pt;">1.1G</p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: rgb(212, 208, 200) windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 244.85pt; background-color: transparent;" valign="top" width="326"><p class="MsoNormal" style="margin: 0in 0in 0pt;">Total usage per doc per year</p></td><td style="border-style: none solid solid none; border-color: rgb(212, 208, 200) windowtext windowtext rgb(212, 208, 200); border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 174.55pt; background-color: transparent;" valign="top" width="233"><p class="MsoNormal" style="margin: 0in 0in 0pt;">2.25G</p></td></tr></tbody></table></p><p>If the database is growing faster than this, there might be a problem.</p><p>The amount of space used by the attachments can be found with the following query:</p><p>select count(*) as Attachments,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; avg(datalength(attachment_image))/1024 as average_size_k,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum(datalength(attachment_image))/1048576 as total_size_m<br>from p_attachment WITH (NOLOCK)<br>go</p><p>The amount of space reserved for the workflow tables can be found with the following script:</p><br><p>select SUM(reserved * 8) / 1024 as Workflow_MB_Reserved<br>from sysindexes i (NOLOCK), sysobjects o (NOLOCK)<br>where i.id = o.id<br>and i.indid IN (0,1,255)<br>and o.name like 'p\_patient\_wp\_%' ESCAPE '\'<br>GO<br></p><p style="font-family: Courier New;" class="MsoNormal"><font size="6"><span style="font-size: 10pt;">Here is a useful query for looking at the size of the p tables:</span></font></p><p style="font-family: Courier New;" class="MsoNormal"><font size="6"><span style="font-size: 10pt;"><br></span></font></p><p>select CAST( o.name AS varchar(40)) as tablename, <br>&nbsp;&nbsp;&nbsp; rowcnt as Rows, <br>&nbsp;&nbsp;&nbsp; (reserved * 8) / 1000 as MB_Reserved<br>from sysindexes i (NOLOCK), sysobjects o (NOLOCK)<br>where i.id = o.id<br>and i.indid IN (0,1)<br>and o.name like 'p\_%' ESCAPE '\'<br>order by o.name<br><br></p></p><h3>Cause</h3><p><p>The two most common causes of excessive growth are scanning documents at too high a resolution, and excessive workflow logs.</p><p><strong>Scanning</strong></p><p>Most of the documents scanned by a practice should be black andwhite and scanned at 150-200 dpi (dots per inch).&nbsp; This shouldgive an averge document size of approximately 15 kb per page.&nbsp; Tofind the average size of the attachments in the database, run thefollowing script:</p><p>select count(*) as Attachments,<br>&nbsp;avg(datalength(attachment_image))/1024 as average_size_k,<br>&nbsp;sum(datalength(attachment_image))/1048576 as total_size_m<br>from p_attachment WITH (NOLOCK)<br>go<br></p><p><strong>Workflow Tables</strong></p><p>There is a known issue prior to build 33.7 and mod level 120 whichsometimes causes EncounterPRO to create too many records in thep_Patient_WP_Item_Progress table.&nbsp; When this happens, EncounterPROuses more space than it needs to and performance can deteriorate.&nbsp;This problem can be detected with the following script:</p><p>select patient_workplan_item_id, count(*)<br>from p_Patient_WP_Item_progress WITH (NOLOCK)<br>where user_id = '#JMJ'<br>group by patient_workplan_item_id<br>having count(*) &gt; 10000<br>GO</p><p>If this script returns any rows, then the problem exists.</p><p>&nbsp;</p></p><h3>Workaround</h3><p><br></p><h3>Resolution</h3><p><p><strong>Scanning</strong></p><p>The solution to having images scanned at too high a resolution is toconfigure and train the scanning personnel to use a lower resolutionwhen scanning new images, and to convert the existing&nbsp;images to alower resolution.&nbsp; There is currently no automated way to convertthe existing images to a lower resolution, but JMJ Support can performthis process manually for a fee.</p><p><strong>Workflow Tables</strong></p><p>Excessive records in the p_Patient_WP_Item_Progress table&nbsp;canbe resolved by upgrading the customer to client version 33.7 or higher,and by running the “Remove Extra WP Item Prog“ utility script found inthe DB Maintenance program.&nbsp; Note that this utility script maylock up the workplan tables for up to 30 minutes, so it should not berun while there are user using EncounterPRO.</p><p>&nbsp;</p></p><h3>Notes</h3><p><br></p>