<h1>Error performing  Close Treatment  service.</h1><h2>10077</h2><h3>Introduction</h3><p><P>The Close Treatment service generally gets performed by the JMJ Service.&nbsp; When the service fails, it can cause a number of problems such as slow performance or reports not printing.</P></p><h3>Symptom</h3><p><P>A service which is part of an attachment workplan might fail with an error such as:</P><P>4.05.33.7 (10/8/2004) &gt;&gt;&gt; u_component_service_close_treatment - (xx_do_service()) Null treatment object.</P><P>OR</P><P>4.05.1.8 (01/10/2005) &gt;&gt;&gt; u_component_service_close_treatment - (do_service()) Error getting treatment object (56512)</P><P>Such a service can be executed by the JMJ server service so the only symptom will be an error like this one in the event viewer.&nbsp; If the customer has not yet been upgraded to use EncounterPRO Server, then other services performed by the JMJ Service (e.g. reports or prescriptions) may slow down or stop altogether.&nbsp; If the service fails many times over the course of several days, it can cause the general performance of EncounterPRO to suffer.</P><P>&nbsp;</P></p><h3>Cause</h3><p><P>There are three known causes of this error.&nbsp; The first is a bug in PowerBuilder which causes the wrong treatment_id to be saved in the p_Patient_WP table when a treatment is created.&nbsp; The second is when the Close Treatment service is put in an Attachment workplan.&nbsp; The third is when the Close Treatment service is put in a workplan whose type is not "Attachment" or "Treatment".</P></p><h3>Workaround</h3><p><P>This first problem (powerbuilder bug) is indicated by an error message like this:</P><P>4.05.1.8 (01/10/2005) &gt;&gt;&gt; u_component_service_close_treatment - (do_service()) Error getting treatment object (56512)</P><P>followed by an error message like this:</P><P>4.05.1.8 (01/10/2005) &gt;&gt;&gt; server - (initialize()) Error performing service (409767) </P><P>In the "Error Performing Service" message, the value between the parentheses is the patient_workplan_item_id of the failing service.&nbsp; If you do not know get the error performaing service error msg, follow these steps.</P><P>Open p_patient_wp_item</P><P>Filter for Active_service_flag = Y</P><P>Filter for owned_by = #JMJ</P><P>get the patient_workplan_item_id for example '13859437'</P><P>To repair the treatment_id for this workplan_item, run the following SQL command:</P><P>EXECUTE jmj_fix_treatment_id &lt;&lt;patient_workplan_item_id&gt;&gt;</P><P>where&nbsp;&lt;&lt;patient_workplan_item_id&gt;&gt;<PATIENT_WORKPLAN_ITEM_ID> <PATIENT_WORKPLAN_ITEM_ID>is from the "Error performing service" message.&nbsp; If the customer is not on Mod Level 124 or higher, then the "jmj_fix_treatment_id" stored procedure can be installed by executing "Hotfix 42 Fix treatment_id Utility.sql".</P><P>The other two causes of this problem are indicated by an error message like this:</P><P>4.05.33.7 (10/8/2004) &gt;&gt;&gt; u_component_service_close_treatment - (xx_do_service()) Null treatment object.</P><P>If the cause of this problem is a close_treatment service in an attachment workplan, then running Hotfix 29 will repair the existing close treatment services and install a trigger to keep the problem from happening again.</P></p><h3>Resolution</h3><p><P>The first problem (powerbuilder bug) is fixed in the EncounterPRO Client version 4.05.33.15 (or higher) and in Database Mod Level 124.</P><P>The second problem (attachment workplan) is fixed in Database Mod Level 123.</P><P>The third problem (workplan type not equal to "Attachment" or "Treatment") is a configuration problem.&nbsp; In this case the error message is the correct response from EncounterPRO, and the deterioration of performance is not an issue if the customer is running EncounterPRO Server for their background services.</P><P>&nbsp;</P></p><h3>Notes</h3><p></p>