<h1>SQL Server Performance - Memory</h1><h2>10087</h2><h3>Introduction</h3><p>SQL Server needs enough memory or performance will suffer.&nbsp; Even if the overall system page fault rate is nominal, SQL Server may still not have enough memory to perform efficiently.</p><h3>Symptom</h3><p><div class="Section1"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">There are two things to check.&nbsp; Both can be found in the performance monitor.</span><o:p></o:p></p><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 10pt; color: navy; font-family: Arial;">1)</span><span style="font-size: 7pt; color: navy;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 10pt; color: navy; font-family: Arial;">Just like any process, does SQL Server have enough working set to operate without paging?</span></p><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 10pt; color: navy; font-family: Arial;">2)</span><span style="font-size: 7pt; color: navy;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-size: 10pt; color: navy; font-family: Arial;">Does SQL Server have enough internal cache to not be recompiling queries all the time?</span><o:p></o:p></p><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">&nbsp;</span><span style="font-size: 10pt; color: navy; font-family: Arial;">To check for the first, look at the Memory object – Pages/Sec counter.&nbsp; It should be at zero with occasional spikes.</span><o:p></o:p></p><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">&nbsp;</span><span style="font-size: 10pt; color: navy; font-family: Arial;">To check for the second, look at the following counters:</span><o:p></o:p></p><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">&nbsp;</span></p><table class="MsoNormalTable" style="border-collapse: collapse;" border="0" cellpadding="0" cellspacing="0"><tbody><tr style=""><td style="border: 1pt solid windowtext; padding: 0in 5.4pt; width: 2.05in;" valign="top" width="197"><p class="MsoNormal"><b><span style="font-size: 10pt; color: navy; font-family: Arial;">Object</span></b><o:p></o:p></p></td><td style="border-style: solid solid solid none; border-color: windowtext windowtext windowtext -moz-use-text-color; border-width: 1pt 1pt 1pt medium; padding: 0in 5.4pt; width: 212pt;" valign="top" width="283"><p class="MsoNormal"><b><span style="font-size: 10pt; color: navy; font-family: Arial;">Counter</span></b><o:p></o:p></p></td><td style="border-style: solid solid solid none; border-color: windowtext windowtext windowtext -moz-use-text-color; border-width: 1pt 1pt 1pt medium; padding: 0in 5.4pt; width: 83.2pt;" valign="top" width="111"><p class="MsoNormal"><b><span style="font-size: 10pt; color: navy; font-family: Arial;">Look For</span></b><o:p></o:p></p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: -moz-use-text-color windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 2.05in;" valign="top" width="197"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">SQL <span class="SpellE">Server:Buffer</span> Manager</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 212pt;" valign="top" width="283"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">Buffer cache hit ratio</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 83.2pt;" valign="top" width="111"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">High 90s</span><o:p></o:p></p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: -moz-use-text-color windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 2.05in;" valign="top" width="197"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">SQL <span class="SpellE">Server:Cache</span> Manager</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 212pt;" valign="top" width="283"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">Cache Hit Ratio – <span class="SpellE">Adhoc</span> <span class="SpellE">Sql</span> Plans</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 83.2pt;" valign="top" width="111"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">High 90s</span><o:p></o:p></p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: -moz-use-text-color windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 2.05in;" valign="top" width="197"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">SQL <span class="SpellE">Server:Cache</span> Manager</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 212pt;" valign="top" width="283"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">Cache Hit Ratio – Prepared <span class="SpellE">Sql</span> Plans</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 83.2pt;" valign="top" width="111"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">High 90s</span><o:p></o:p></p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: -moz-use-text-color windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 2.05in;" valign="top" width="197"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">SQL <span class="SpellE">Server:Cache</span> Manager</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 212pt;" valign="top" width="283"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">Cache Hit Ratio – Trigger Plans</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 83.2pt;" valign="top" width="111"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">High 90s</span><o:p></o:p></p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: -moz-use-text-color windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 2.05in;" valign="top" width="197"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">SQL <span class="SpellE">Server:Cache</span> Manager</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 212pt;" valign="top" width="283"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">Cache Hit Ratio – Procedure Plans</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 83.2pt;" valign="top" width="111"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">90+</span><o:p></o:p></p></td></tr><tr style=""><td style="border-style: none solid solid; border-color: -moz-use-text-color windowtext windowtext; border-width: medium 1pt 1pt; padding: 0in 5.4pt; width: 2.05in;" valign="top" width="197"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">SQL <span class="SpellE">Server:Cache</span> Database</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 212pt;" valign="top" width="283"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">Log Cache Hit Ratio – &lt;<span class="SpellE">cpr</span> database&gt;</span><o:p></o:p></p></td><td style="border-style: none solid solid none; border-color: -moz-use-text-color windowtext windowtext -moz-use-text-color; border-width: medium 1pt 1pt medium; padding: 0in 5.4pt; width: 83.2pt;" valign="top" width="111"><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">80+</span><o:p></o:p></p></td></tr></tbody></table><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">Not having the numbers high enough isn’t necessarily a problem by itself. &nbsp;That is, if the system is performing well and these numbers are lower than they should be, don’t worry about it. &nbsp;If the system is not performing well and these numbers are too low, then giving more RAM to SQL server is definitely something to try.</span><o:p></o:p></p><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;"></span><o:p></o:p></p><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">Also, not having enough ram will show up in a SQL trace because it is a likely cause of queries taking too long when the # of reads isn’t elevated and the processor and disk queue are nominal.</span><o:p></o:p></p><p class="MsoNormal"><span style="font-size: 10pt; color: navy; font-family: Arial;">&nbsp;</span></p></div></p><h3>Cause</h3><p></p><h3>Workaround</h3><p></p><h3>Resolution</h3><p><p>If SQL Server does not have enough memory, set the maximum memory slider all the way to the right on the SQL Server Properties/Memory screen in the SQL Enterprise Manager.&nbsp; If SQL takes so much memory that other parts of windows suffer, or if SQL takes as much memory as it can but still doesn't have enough, then the server probably needs to have more RAM installed.</p><p>&nbsp;SQL 2000 Standard will not be allowed to consume more than about 1.7G of RAM.&nbsp; If SQL 2000 is already using that much but still suffers from depressed cache hit ratios and poor performance, then the customer should consider either SQL 2005 or SQL 2000 Enterprise Edition.<br></p></p><h3>Notes</h3><p></p>