<h1>Reopening Medications that were accidentally closed</h1><h2>10118</h2><h3>Introduction</h3><p>This article provides information on how to re-open all of the medications that were closed by a certain user or by #SYSTEM</p><h3>Symptom</h3><p></p><h3>Cause</h3><p>Client was closing medication from Outstanding RX screen or user requested that we close all medication on Outstanding RX screen</p><h3>Workaround</h3><p></p><h3>Resolution</h3><p>-------------------------------------------------------------------------------------------------------------------------------------------------------------- This script loops through the specified treatment items-- and reopens them.  The items to reopen are specified in the-- cursor declare WHERE clause.------------------------------------------------------------------------------------------------------------------------------------------------------------DECLARE @ls_cpr_id varchar(12),@ll_treatment_id int,@ll_encounter_id int,@ls_progress_type varchar(24),@ldt_closed_from_date datetime,@ldt_closed_to_date datetime,@ls_closed_by varchar(24)-------------------------------------------------------------------------------------------------------------------------------------------------------- Edit these values to identify when and who closed the medicationsSET @ldt_closed_from_date = '12/25/2004'SET @ldt_closed_to_date = '1/5/2005'SET @ls_closed_by = '#SYSTEM' ------------------------------------------------------------------------------------------------------------------------------------------------------DECLARE lc_items CURSOR LOCAL FAST_FORWARD FORSELECT t.cpr_id, t.treatment_id, t.open_encounter_idFROM p_Treatment_Item t INNER JOIN p_Treatment_Progress p ON t.cpr_id = p.cpr_id and t.treatment_id = p.treatment_id WHERE p.user_id = @ls_closed_byand p.created > @ldt_closed_from_dateand p.created < @ldt_closed_to_dateand p.progress_type = 'closed' And t.treatment_type='MEDICATION' and t.treatment_status = 'Closed'SET @ls_progress_type = 'Reopen'OPEN lc_itemsFETCH lc_items INTO @ls_cpr_id, @ll_treatment_id, @ll_encounter_idWHILE @@FETCH_STATUS = 0BEGINEXECUTE sp_set_treatment_progress@ps_cpr_id = @ls_cpr_id,@pl_treatment_id = @ll_treatment_id,@pl_encounter_id = @ll_encounter_id,@ps_progress_type = @ls_progress_type,@ps_progress_key = NULL,@ps_progress = NULL,@pdt_progress_date_time = NULL,@ps_user_id = '#SYSTEM',@ps_created_by = '#SYSTEM'FETCH lc_items INTO @ls_cpr_id, @ll_treatment_id, @ll_encounter_idENDCLOSE lc_itemsDEALLOCATE lc_items</p><h3>Notes</h3><p></p>