<h1>Changing the drug administer frequency in version 4</h1><h2>10164</h2><h3>Introduction</h3><p><P>The administer_frequency value in c_Administration_Frequency is, for the most part, the visible part of the administer frequency.&nbsp; However, it is also a key so it cannot be changed.&nbsp; If the customer wants to change the wording (e.g. from 'BID' to 'Twice a Day'), we need to add the new record to c_Administration_Frequency, mark the old one as 'NA', and update the foreign keys in other tables.</P><FONT color=#000080 size=2><P><FONT color=#000000 size=3>You don’t need to do anything except identify the old administer_frequency value, decide what the new one should be, edit the indicated place in the script, and run it. The script will do everything.</FONT></P><P><FONT color=#000000 size=3>Another thing… I made it a point to preserve the [description] field from the old to the new record. This is to discourage changing the "meaning" of the c_Administration_Frequency record, like if you were to change "BID" to "6X per Day". One more thing… you only have 12 characters for the administer_frequency value.</FONT></P></FONT></p><h3>Symptom</h3><p></p><h3>Cause</h3><p></p><h3>Workaround</h3><p><P>The following SQL script will create the new c_Administration_Frequency record, mark the old one as 'NA', and update the foreign keys so that future drug orders will use the new administer_frequency.&nbsp; Make sure you modify the old and new administer_frequence values BEFORE running the script.</P><P>--------------------------------------------------------------------------</P><P><BR>DECLARE @ls_old_administer_frequency varchar(12),<BR>&nbsp;@ls_new_administer_frequency varchar(12)</P><P>-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<BR>-- ***************************************************************<BR>-- BEFORE RUNNING THIS SCRIPT, MODIFY THESE VALUES TO THE OLD AND<BR>-- NEW [administer_frequency] VALUES, RESPECTIVELY.<BR>SET @ls_old_administer_frequency = 'BID'<BR>SET @ls_new_administer_frequency = 'Twice a Day'<BR>-- ***************************************************************<BR>-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</P><P>INSERT INTO c_Administration_Frequency (<BR>&nbsp;administer_frequency,<BR>&nbsp;description,<BR>&nbsp;frequency,<BR>&nbsp;sort_sequence,<BR>&nbsp;status,<BR>&nbsp;id)<BR>SELECT &nbsp;@ls_new_administer_frequency,<BR>&nbsp;description,<BR>&nbsp;frequency,<BR>&nbsp;sort_sequence,<BR>&nbsp;status,<BR>&nbsp;newid()<BR>FROM c_Administration_Frequency<BR>WHERE administer_frequency = @ls_old_administer_frequency<BR>AND NOT EXISTS (SELECT 1 FROM c_Administration_Frequency WHERE administer_frequency = @ls_new_administer_frequency)</P><P>UPDATE c_Administration_Frequency<BR>SET status = 'OK'<BR>WHERE administer_frequency = @ls_old_administer_frequency<BR>AND status = 'OK'</P><P>UPDATE c_Administration_Frequency<BR>SET status = 'NA'<BR>WHERE administer_frequency = @ls_old_administer_frequency<BR>AND status = 'OK'</P><P>UPDATE c_Drug_Administration<BR>SET administer_frequency = @ls_new_administer_frequency<BR>WHERE administer_frequency = @ls_old_administer_frequency</P><P>UPDATE u_Assessment_Treat_Def_Attrib<BR>SET value = @ls_new_administer_frequency<BR>WHERE attribute = 'administer_frequency'<BR>AND value = @ls_old_administer_frequency</P><P>GO<BR></P><P>&nbsp;</P></p><h3>Resolution</h3><p></p><h3>Notes</h3><p></p>