<h1>Barton Schmitt does not calculate a recommendation</h1><h2>10252</h2><h3>Introduction</h3><p></p><h3>Symptom</h3><p></p><h3>Cause</h3><p>Incorrect script in c_property.script for function_name bds_recommendation.</p><h3>Workaround</h3><p></p><h3>Resolution</h3><p><P>Go to&nbsp; c_property table</P><P>Search for&nbsp; %barton% &nbsp;in the description field</P><P>Copy the script below into the script field.</P><P>&nbsp;</P><P><FONT color=#0000ff>Function bds_recommendation(a, b(), c())<BR>&nbsp;&nbsp;&nbsp; 'Set fs = CreateObject("Scripting.FileSystemObject")<BR>&nbsp;&nbsp;&nbsp; 'Set file = fs.opentextfile("C:\temp\bds_recommendation.txt", 8, True, 0)<BR>&nbsp;&nbsp;&nbsp; 'file.Write "running bds_recommendation" &amp; Chr(13) + Chr(10)<BR>&nbsp;&nbsp;&nbsp; Dim CprId, TreatmentId, SqlQuery, RecSet, RootObsSeq, Com, ChildObsSeq(), ChildObsName(), i<BR>&nbsp;&nbsp;&nbsp; Set RecSet = CreateObject("ADODB.Recordset")<BR>&nbsp;&nbsp;&nbsp; RecSet.Open "SELECT user_name()", ADODB_Connection, 3, 1, 1<BR>&nbsp;&nbsp;&nbsp; 'file.Write RecSet(0) &amp; Chr(13) + Chr(10)<BR>&nbsp;&nbsp;&nbsp; RecSet.Close</FONT></P><P><FONT color=#0000ff>&nbsp;&nbsp;&nbsp; 'For i = 1 To a<BR>For i = Lbound(b) to Ubound(b)&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'file.Write Chr(13) + Chr(10) &amp; b(i) &amp; Chr(13) + Chr(10) &amp; c(i) &amp; Chr(13) + Chr(10)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If UCase(b(i)) = "CPR_ID" Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CprId = c(i)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ElseIf UCase(b(i)) = "TREATMENT_ID" Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TreatmentId = c(i)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp; Next<BR>&nbsp;&nbsp;&nbsp; SqlQuery = "SELECT p_Observation.observation_sequence " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "From p_Observation " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "INNER JOIN p_Treatment_Item " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "ON p_Observation.observation_id = p_Treatment_Item.observation_id " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "AND p_Observation.cpr_id = p_Treatment_Item.cpr_id " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "AND p_Observation.treatment_id = p_Treatment_Item.treatment_id " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Where p_Observation.parent_observation_sequence Is Null " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "AND p_Treatment_Item.cpr_id = '" &amp; CprId &amp; "' " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "AND p_Treatment_Item.treatment_id = '" &amp; TreatmentId &amp; "' " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "ORDER BY p_Observation.branch_sort_sequence, p_Observation.observation_sequence"<BR>&nbsp;&nbsp;&nbsp; RecSet.Open SqlQuery, ADODB_Connection, 3, 1, 1<BR>&nbsp;&nbsp;&nbsp; If RecSet.RecordCount &lt; 1 Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit Function<BR>&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp; RootObsSeq = RecSet("observation_sequence")<BR>&nbsp;&nbsp;&nbsp; RecSet.Close<BR>&nbsp;&nbsp;&nbsp; SqlQuery = "SELECT p_Observation.observation_sequence, c_Observation.description " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "From p_Observation " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "INNER JOIN c_Observation ON c_Observation.observation_id = p_Observation.observation_id " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Where p_Observation.parent_observation_sequence = '" &amp; RootObsSeq &amp; "' " &amp; _<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "ORDER BY p_Observation.branch_sort_sequence, p_Observation.observation_sequence"<BR>&nbsp;&nbsp;&nbsp; RecSet.Open SqlQuery, ADODB_Connection, 3, 1, 1<BR>&nbsp;&nbsp;&nbsp; ReDim ChildObsSeq(RecSet.RecordCount)<BR>&nbsp;&nbsp;&nbsp; ReDim ChildObsName(RecSet.RecordCount)<BR>&nbsp;&nbsp;&nbsp; i = 1<BR>&nbsp;&nbsp;&nbsp; While Not RecSet.EOF<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ChildObsSeq(i) = RecSet("observation_sequence")<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ChildObsName(i) = Trim(RecSet("description"))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If InStr(Len(ChildObsName(i)) - 2, ChildObsName(i), "if", 1) &gt; 0 Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ChildObsName(i) = Trim(Left(ChildObsName(i), Len(ChildObsName(i)) - 2))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RecSet.MoveNext<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i = i + 1<BR>&nbsp;&nbsp;&nbsp; Wend<BR>&nbsp;&nbsp;&nbsp; RecSet.Close<BR>&nbsp;&nbsp;&nbsp; <BR>&nbsp;&nbsp;&nbsp; Set Com = CreateObject("ADODB.Command")<BR>&nbsp;&nbsp;&nbsp; Com.ActiveConnection = ADODB_Connection<BR>&nbsp;&nbsp;&nbsp; For i = 1 To UBound(ChildObsSeq)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Com.CommandText = "declare @r int exec @r = sp_patient_any_results '" &amp; CprId &amp; "', " &amp; ChildObsSeq(i) &amp; ", NULL, 'Y' select @r"<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Set RecSet = Com.Execute<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If Not RecSet.EOF Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If RecSet(0) &gt; 0 Then<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bds_recommendation = ChildObsName(i)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Exit Function<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; End If<BR>&nbsp;&nbsp;&nbsp; Next<BR>&nbsp;&nbsp;&nbsp; bds_recommendation = "&lt;<NO recommendation>&gt;"<BR>End Function</FONT></P></p><h3>Notes</h3><p></p>