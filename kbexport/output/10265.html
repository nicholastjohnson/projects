<h1>How to shrink EncounterPRO scanned document attachments</h1><h2>10265</h2><h3>Introduction</h3><p><P><STRONG><FONT size=4>Things you will need to proceed:</FONT></STRONG></P><UL><LI><STRONG><FONT color=#ff0000>Utmost caution!&nbsp; Read this article in its entirety and then read it again before actually doing anything!</FONT></STRONG> <LI>A batch image conversion program.&nbsp; JMJ uses a licensed version of 2TIFF, which works very reliably on nearly any type of image&nbsp;and is inexpensive.&nbsp; It appears to be somewhat slow for some images, but I have not found a more reliable&nbsp;batch image converter.&nbsp; It can be found <A href="http://www.2tiff.com/">here</A>.&nbsp; If you work for JMJ, our licensed copy is stored <A href="file://labserv2003/Common/Support/Tools">here</A>. <LI>The EPAttachments tool which is used to extract attachments from the EncounterPRO database before conversion and to shove them back into the database after conversion has been completed, ultimately reducing the size of the attachments data file.&nbsp; The EPAttachments tool can be found on the <A href="ftp://www.jmjtech.com/">JMJ FTP site</A>&nbsp;under JMJSupport/EPAttachments. <LI>Free disk space equal to 2.5 to 3 times the size of the attachments data file.&nbsp; So if your attachments data file consumes 25GB of disk space, you need about 63 to 75 GB of free space before you attempt to perform an attachments shrink.&nbsp; This space does not have to be on the server.&nbsp; It can be on&nbsp;another computer on the network. <LI>Several hours, depending on the number of attachments and the speed of the computer you are working on, to perform the entire process.&nbsp; It is not unusual for the entire process to take more than three days.&nbsp; It can be done during business hours, but performance <STRONG>will</STRONG> be impacted, so this is not recommended.</LI></UL></p><h3>Symptom</h3><p><BR></p><h3>Cause</h3><p><BR></p><h3>Workaround</h3><p><BR></p><h3>Resolution</h3><p><H3><FONT face="Courier New">PERFORM ALL STEPS ON THE CONSOLE SESSION.&nbsp; IF YOU ARE USING RDP, RUN mstsc.exe WITH THE /console COMMAND LINE ATTRIBUTE.&nbsp; THIS WILL ENSURE THAT THE PROCESSES CONTINUE EVEN IF YOUR RDP CLIENT IS DISCONNECTED.</FONT></H3><H3>Step One:</H3><P><STRONG><FONT color=#ff0000>Create a backup of the entire attachments data file and store it in a safe location <U>indefinitely</U>.</FONT></STRONG></P><H3>Step Two:</H3><P>The first order of business is extracting the attachments from the EncounterPRO database.&nbsp; The EPAttachments tool is used for this step.&nbsp; To use it, supply the server and database names and a working folder with enough space to hold all of the attachments.&nbsp; If you wish to extract only a subset of the attachments in the EncounterPRO database, you can modify the where clause used in the query driving the extraction by clicking the "Edit Query" button.</P><P>Once you have supplied the needed information, click the "Download" button and wait for the process to complete.</P><P><STRONG><FONT size=4>Step Three:</FONT></STRONG></P><P>The next step is to convert the images to 150x150 1bpp images with CCITT-4 Tiff compression.&nbsp; If you are using 2Tiff, you must execute&nbsp;the batch process from the command line like this:</P><P><CODE>"C:\Program Files\2Tiff\2TIFF.EXE" s="D:\Extracted Attachments\*.tif" d="D:\Shrunk Attachments" -dpiver150 -dpihor150 -ct3</CODE></P><P>Consult the 2TIFF help document if you want detailed information on what the various flags mean.</P><H3>Step Four:</H3><P>Assuming the conversion is complete, you should now have exactly the same number of *.tif files in your "D:\Extracted Attachments" folder and your "D:\Shrunk Attachments" folder.&nbsp; Make sure that the files have decreased in size and that they are <STRONG>legible</STRONG>.&nbsp; Sometimes, particularly with very dark images, some files are no longer legible after a conversion.</P><P>To update the EncounterPRO database you'll use the EPAttachments tool again.&nbsp; </P><P>Again, provide the server and database name, and for the working folder, direct the application to the path where the converted attachments are.&nbsp; When you are ready to begin, click the "Upload" button.&nbsp; As each attachment is written to the database, the corresponding file is moved into a "done" subdirectory in the working folder, so that you may run the process again if an error occurs without having to repeat the insertion of attachments that already updated successfully.</P><P>Once that completes, proceed to</P><H3>Step Five:</H3><P>Make sure that the attachments data file is now mostly free space and that the updated images are viewable from within EncounterPRO.&nbsp; Once this has been verified, you may perform any cleanup work, including but not limited to:</P><UL><LI>Remove "Extracted Attachments" and "Shrunk Attachments" folders <LI>Remove EPAttachments tool <LI>Remove 2Tiff or the batch image converter you used for the operation <LI>Shrink the attachments data file <LI>Shrink the transaction log data file</LI></UL></p><h3>Notes</h3><p></p>