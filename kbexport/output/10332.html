<h1>Create Attachment Filegroup in 4.0</h1><h2>10332</h2><h3>Introduction</h3><p></p><h3>Symptom</h3><p></p><h3>Cause</h3><p></p><h3>Workaround</h3><p></p><h3>Resolution</h3><p><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.25in; TEXT-INDENT: -0.25in; mso-list: l2 level1 lfo1; tab-stops: list .25in"><SPAN style="mso-list: Ignore">1.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Bring up SQL Query Analyzer.</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.25in; TEXT-INDENT: -0.25in; mso-list: l2 level1 lfo1; tab-stops: list .25in"><SPAN style="mso-list: Ignore">2.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Open and run the<SPAN style="COLOR: blue"> <A href="https://www.jmjtech.com/kb/images/10332/AttachmentsFilegroup.txt">Attachments Filegroup.sql</A></SPAN> script located on the CD under EncounterPRO\Database\ 4.05\Upgrade</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.75in; TEXT-INDENT: -0.25in; mso-list: l2 level2 lfo1; tab-stops: list .75in"><SPAN style="mso-list: Ignore">a.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Before running the above script you need to find out the size of the attachment tables then add them together and edit the script to indicate the total size</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 1in; TEXT-INDENT: -0.25in; mso-list: l0 level1 lfo2; tab-stops: list 1.0in"><SPAN style="mso-list: Ignore">i.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Run sp_spaceused ‘p_attachment’</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 1.25in; TEXT-INDENT: -0.5in; mso-list: l1 level1 lfo3; tab-stops: list 1.0in"><SPAN style="mso-list: Ignore">ii.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Run sp_spaceused ‘p_attachment_progress’</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.75in; TEXT-INDENT: -0.25in; mso-list: l2 level2 lfo1; tab-stops: list .75in"><SPAN style="mso-list: Ignore">b.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Make sure you read the instructions at the top of the script before running</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.75in; TEXT-INDENT: -0.25in; mso-list: l2 level2 lfo1; tab-stops: list .75in"><SPAN style="mso-list: Ignore">c.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>This script will create a new file group for the database that will hold just the p_attachment tables.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>This gives the practice the ability to put their attachments on a different drive than the database.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>You can modify this script to put the new file group on what ever drive you want it on.</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.75in; TEXT-INDENT: -0.25in; mso-list: l2 level2 lfo1; tab-stops: list .75in"><SPAN style="mso-list: Ignore">d.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Open and run the <A href="https://www.jmjtech.com/kb/images/10332/Attachmentsrebuild.txt"><SPAN style="COLOR: blue">Attachments Rebuild.sql</SPAN> </A>script located on the CD under EncounterPRO\Database\ 4.05\Upgrade.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>(This will take a while to run depending on the size of the attachment tables.)</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.25in; TEXT-INDENT: -0.25in; mso-list: l2 level1 lfo1; tab-stops: list .25in"><SPAN style="mso-list: Ignore">3.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Make sure the [database_mode] field in c_Database_Status is set to ‘Production’</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.25in; TEXT-INDENT: -0.25in; mso-list: l2 level1 lfo1; tab-stops: list .25in"><SPAN style="mso-list: Ignore">4.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Set the [customer_id] field in c_Database_Status with the below script.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Make sure you replace <B style="mso-bidi-font-weight: normal">CUSTOMER#</B> with the appropriate #.</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.75in"><?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /><o:p>&nbsp;</o:p></P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.75in">UPDATE c_database_status<BR>SET customer_id = ‘<B style="mso-bidi-font-weight: normal"><I style="mso-bidi-font-style: normal">CUSTOMER#</I></B>’</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.75in"><B style="mso-bidi-font-weight: normal"><I style="mso-bidi-font-style: normal"><o:p>&nbsp;</o:p></I></B></P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.25in; TEXT-INDENT: -0.25in; mso-list: l2 level1 lfo1; tab-stops: list .25in"><SPAN style="mso-list: Ignore">5.<SPAN style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></SPAN>Dump the transaction log using the following script</P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.25in"><o:p>&nbsp;</o:p></P><P class=MsoNormal style="MARGIN: 0in 0in 0pt 0.75in">DUMP TRANSACTION <B style="mso-bidi-font-weight: normal">cpr</B> WITH NO_LOG</P></p><h3>Notes</h3><p></p>