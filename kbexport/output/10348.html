<h1>Migration Procedures from Version 2 to Version 4</h1><h2>10348</h2><h3>Introduction</h3><p><p>&nbsp;</p></p><h3>Symptom</h3><p><br></p><h3>Cause</h3><p><br></p><h3>Workaround</h3><p><br></p><h3>Resolution</h3><p><font style="font-family: arial;" size="2">If you are uploading databases please password protect it<br><br></font><ol style="color: rgb(0, 0, 128); font-family: arial;" type="1"><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Create Database and call it cpr_40</span></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;"></span><span style="font-size: 10pt;">Install latest migration version</span></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;"></span></font><font size="2"><span style="font-size: 10pt;"></span></font><font size="2"><span style="font-size: 10pt;">Install Migration Reports \EP_Upgrades\Production\4.05\NewDBInstall\MigrationReports</span></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Rename Version 2.0 icon to "EPRO Live"</span></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;"></span></font><font size="2"><span style="font-size: 10pt;">Install EncounterPRO&nbsp; (Make sure you change the path to EncounterPRO_40)</span></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;"><span style="font-size: 10pt;">Rename Version 4.0 icon to "EPRO 4.0"</span></span></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;"><span style="font-size: 10pt;">Re-install VS 2.0 (Make sure you point th epath to where 2.0 was installed)</span></span></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Backup the version 2 database </span></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;"></span><o:p></o:p>Run the below script. You will need to replace <span style="font-style: italic;"><span style="color: rgb(0, 0, 255);">CUSTOMER#</span> with customer ID<br></span></font><font size="2">UPDATE c_database_status<br>SET customer_id <span style="font-weight: bold;">= '</span></font><font size="2"><span style="font-style: italic;"><span style="color: rgb(0, 0, 255);">CUSTOMER#</span>'</span></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Update Database<span style="font-size: 10pt;"> </span><o:p></o:p></font><ol type="1"><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Open EproServer<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on "Updates tab"<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Upgrade "Database" to mod level 126<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Restart DB Maintenance Mode if "Reports" does not appear<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Upgrade "Reports"<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Upgrade "Config" to current level<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Run all "Hot Fixes"<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Backup Version 4 database and call it "cpr_40_PreMigration" (optional based on space availablity)</span><o:p></o:p></font></li></ol></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Migrate Prep Data (<strong>Check to make sure that it has not been done before and do not proceed&nbsp;<span style="font-weight: bold;">without the Migration Questions filled out by practice- you can check c_users&nbsp; for new practice data</span></strong>)<span style="font-size: 10pt;"> </span><o:p></o:p></font><ol type="1"><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Open the DB Maintenance Mode<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on "Migrate" tab<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on "Prep" button<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on "Refresh Scripts" button (Ensure that it says 4.05.13)<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Enter in version 2 Database name in "Database field" (Usually called "cpr")<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on "Execute" button<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Select "yes" to the pop up screens (unless the practice&nbsp;opts for "no")</span></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">If Speciality is other then Pediatrics. Select Clear and select current Speciality. Ensure that only one Speciality is selected.</span></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Select "Yes" to execute the migrate "Prep" data</span></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">When the previous step is complete: <br></span></font></li><ol><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Repeat steps 10.1 thru 10.3 (this time upgrading the database mod level to 127)</span></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Run "Check Now" again</span></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Click "Hotfixes" tab and re-run all hotfixes <br></span></font></li></ol></ol></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Migrate Patient Data<span style="font-size: 10pt;"> (<strong>This may not always been done during the dry run or on the same day-It can be done as many times as needed </strong>)</span> </font><ol type="1"><font size="2"><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Open the DB Maintenance Mode<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on "Migrate" tab<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on "Patient" button<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on "Refresh Scripts" button </font><font size="2">(Ensure that it says 4.05.13)</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Enter in version 2 Database name in "Database field" (Usually called "cpr")<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on "Execute" button<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Select "yes" to the pop up screens </span></font></li></font></ol></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Run Utility Scripts<span style="font-size: 10pt;"> </span><o:p></o:p></font><ol type="1"><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Open the DB Maintenance Mode<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Click on the "Utilities Scripts" tab<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Select "DB Scripts" and click "Execute"&nbsp; (for 126 run&nbsp;this script in Query <a href="https://www.jmjtech.com/kb/images/10331/DBScripts126.txt">click here</a>)</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Insure that "Executing Script Succeeded" displays<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Re-run all hot fixes<span style="font-size: 10pt;"> </span></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Click on the "Tools" tab </span></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Run "Modified Repair Medications Utility" </span></font></li></ol></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Shrink the log file<span style="font-size: 10pt;"> </span><o:p></o:p></font><ol type="1"><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Run this command in the Query Analyzer&nbsp;window: Dump transaction cpr_40 with no_log<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">(CAN BE RAN DURING DRY-RUN) Shrink the DB by running "Shrink Transaction log.sql" <a href="https://www.jmjtech.com/kb/images/10331/ShrinkTransactionLog.txt"><span class="SpellE">Shrink</span> Transaction Log</a></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><font size="3">(don't do during dry-run)<o:p></o:p> </font>In Enterprise Manager, right-click on the version 4 database and select "Shrink Database"<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Shrink DB in SQL to 5 %</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Select "Move pages to beginning of file before shrinking"<span style="font-size: 10pt;"> </span></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Click Ok</span></font></li></ol><font size="2"></font></li><font size="2"><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">SQL Jobs</font> (If they are a MPT practice consult with them first) <ol><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Remove Jobs for Version 2.0</font> (DON'T DO DURING DRY RUN) </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Ensure that SQL Jobs are set up for Version 4.0. If they are not set up run below script&nbsp;“<a href="https://www.jmjtech.com/kb/images/10287/cpr_40_Maintenance_Scripts.txt">4.0 Maintenance Jobs</a>” </font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Run all Jobs one at a time</font></li></ol></li></font><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Backup the version 4 database and call it cpr_40_post_Migration (</font><font size="2"><span style="font-size: 10pt;">optional based on space availablity</span></font><font size="2">)</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Ensure that c_attachment_location is set up correctly</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Ensure that CPRFILES is properly shared and the server has a c:\temp</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Copy install files to CPRFILES\Install</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Set up automatic printing&nbsp; <a href="https://192.168.155.2/kb/Article.aspx?ArticleNumber=10199">https://192.168.155.2/kb/Article.aspx?ArticleNumber=10199</a></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Set PMS Interface<span style="font-size: 10pt;"> </span><o:p></o:p></font><ol type="1"><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Select the Practice Management tab in EPRO Configuration and select correct PMS<span style="font-size: 10pt;"> </span><o:p></o:p></font></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><span style="font-size: 10pt;">Ensure that PMS System exists in the c_offfice table and records exist in o_message_subscription (make sure paths are the same as version 2)</span><o:p></o:p></font></li></ol></li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Compare appointment types in version 2 b_appt_type table to that of the version 4 b_appt_type table to assure accuracy</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Ensure that c_office has the correct&nbsp;billing component and billing ID. Most of the time it will be ENCOUNTERPRO_BILL</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Open up 2.0 and make sure you can view a scanned image. If not try re-installing 2.0 or EPROLIBNET</font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2"><strong>Send&nbsp;client Pre-Migration completion letter found under \Cd4.05.33\Upgrade Checklists\Migration Checklists</strong></font> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><font size="2">Please run the following queries (one at a time)</font></li></ol><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em>Update p_patient_encounter<o:p></o:p></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em>Set stone_flag='Y'<o:p></o:p></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em>Where stone_flag = 'N'<o:p></o:p></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em>And encounter_status = 'CLOSED'<o:p></o:p></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><o:p><em>&nbsp;</em></o:p></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em>Update p_patient_wp_item<o:p></o:p></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em>SET status = ‘CANCELLED’<o:p></o:p></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span><em><font size="2">WHERE ordered_service = ‘SENBILLING’<o:p></o:p></font></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em><span style="font-family: arial;">AND status in </span><span>('DISPATCHED','STARTED')</span></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em><span><font size="2"></font></span></em></span>&nbsp;</p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em><span><span style="font-weight: normal; font-size: 12pt;"><font size="2">UPDATE p_Patient_Encounter</font></span></span></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em><span><span style="font-weight: normal; font-size: 12pt;"><font size="2">SET encounter_status = ‘CLOSED’</font></span></span></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em><span><span style="font-weight: normal; font-size: 12pt;"></span><span style="font-weight: normal; font-size: 12pt;"><font size="2">WHERE encounter_status = ‘OPEN’</font></span></span></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em><span><span style="font-weight: normal; font-size: 12pt;"></span></span></em></span>&nbsp;</p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em><span><span style="font-weight: normal; font-size: 12pt;"></span></span></em></span><span style="font-size: 10pt;"><em><span><span style="font-weight: normal; font-size: 12pt;"><font size="2">update c_user set supervisor_user_id = NULL </font></span></span></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em><span><span style="font-weight: normal; font-size: 12pt;"><font size="2">where supervisor_user_id IS NOT NULL </font></span></span></em></span></p><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><span style="font-size: 10pt;"><em><span><span style="font-weight: normal; font-size: 12pt;"><font size="2">AND supervisor_user_id NOT IN ( SELECT user_id FROM c_User)<font face="Arial"> </font></font></span></span></em></span></p><o:p></o:p><span style="font-size: 10pt;"><em><span><p class="MsoNormal" style="margin: 0in 0in 0pt 0.5in; color: rgb(0, 0, 128); text-indent: 0.5in; font-family: arial;"><br></p></span></em></span><span style="font-family: arial;"><br><br></span><p style="color: rgb(0, 0, 128); font-family: arial;"><font size="2"></font>&nbsp;</p><br><p style="color: rgb(0, 0, 128); font-family: arial;"><font size="2"><span style="font-size: 10pt;"></span><o:p></o:p></font></p></p><h3>Notes</h3><p><ol style="margin-top: 0in;" type="1"><li class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-weight: normal; font-size: 12pt;">Create new test patient<o:p></o:p></span> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-weight: normal; font-size: 12pt;">Create encounters from simple to complex types<o:p></o:p></span> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-weight: normal; font-size: 12pt;">View &amp; print frequently used reports</span> </li><li class="MsoNormal" style="margin: 0in 0in 0pt;"><span style="font-weight: normal; font-size: 12pt;">View Scanned Image<br></span></li></ol><span style="font-weight: normal; font-size: 12pt;"><br></span></p>