<h1>Treatment Create fails with  String or binary data would be truncated</h1><h2>10383</h2><h3>Introduction</h3><p></p><h3>Symptom</h3><p><P>When a new treatment is ordered the treatment does not get created and an error like the following shows up in the event viewer:<BR>&nbsp;<BR>4.05.33.7 (10/8/2004) &gt;&gt;&gt; u_ds_treatment_item - (dberror) DATAWINDOW SQL ERROR = (8152) SQLSTATE = 22001</P><P>Microsoft OLE DB Provider for SQL Server</P><P>String or binary data would be truncated.</P><P>No changes made to database.</P><P>INSERT INTO p_Treatment_Item ( cpr_id, open_encounter_id, treatment_type, specialty_id, treatment_mode, begin_date, duration_prn, treatment_description, attach_flag, referral_question, referral_question_assmnt_id, ordered_by, created_by ) VALUES ( '347', 11442, 'REFERRAL', '$ALLERGY', 'Referral - Review Immediately', {ts '2005-08-31 09:14:35.000'}, 'ASAP', 'Allergy and Immunology, asap to evaluate for asthmatic bronchitis, chronic ', '', 'Evaluate For', 'DEMO10629', 'SUPPORT', 'SUPPORT')</P><P>&nbsp;</P></p><h3>Cause</h3><p>The cause of this error is the treatment_mode field being too long.&nbsp; The treatment_mode values in the c_Treatment_Workplan table cannot be too long by definition, but treatment_mode attributes defined for menus and workplans can be too long.&nbsp; Also, menu and workplan attributes that in turn reference global properties stored in o_Preferences can be too long if configured incorrectly.</p><h3>Workaround</h3><p><P>Run the following query to identify workplan items, menu items, and global properties which may&nbsp;contain treatment_mode&nbsp;values in excess of 24 characters.&nbsp; From the data returned, identify and fix the incorrect configuration.</P><P>-------------------------------------------------------</P><P>select w.workplan_id, w.description, i.step_number, i.ordered_treatment_type, i.item_number, a.attribute_sequence, a.attribute, a.value<BR>FROM c_Workplan w<BR>&nbsp;INNER JOIN c_Workplan_Item i<BR>&nbsp;ON w.workplan_id = i.workplan_id<BR>&nbsp;INNER JOIN c_Workplan_Item_Attribute a<BR>&nbsp;ON i.workplan_id = a.workplan_id<BR>&nbsp;AND i.item_number = a.item_number<BR>WHERE attribute = 'treatment_mode'<BR>and len(value) &gt; 24<BR>and left(value, 1) &lt;&gt; '%'</P><P>select w.menu_id, w.description, i.menu_item, i.menu_item_id, a.menu_item_attribute_sequence, a.attribute, a.value<BR>FROM c_menu w<BR>&nbsp;INNER JOIN c_menu_Item i<BR>&nbsp;ON w.menu_id = i.menu_id<BR>&nbsp;INNER JOIN c_menu_Item_Attribute a<BR>&nbsp;ON i.menu_id = a.menu_id<BR>&nbsp;AND i.menu_item_id = a.menu_item_id<BR>WHERE attribute = 'treatment_mode'<BR>and len(value) &gt; 24<BR>and left(value, 1) &lt;&gt; '%'</P><P>select *<BR>from o_preferences<BR>WHERE preference_id LIKE '%treatment%mode%'<BR>and len(preference_value) &gt; 24</P><P>&nbsp;</P><P>-----------------------------------------------------------</P></p><h3>Resolution</h3><p>This problem has been reported as issue # 6212 and will be fixed in a future release of EncounterPRO.</p><h3>Notes</h3><p></p>