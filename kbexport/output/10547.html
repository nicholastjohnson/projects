<h1>Error merging patient accounts</h1><h2>10547</h2><h3>Introduction</h3><p></p><h3>Symptom</h3><p><P>The Merge Patients service fails with an error like this one in the event viewer:</P><P>EproLibNET version: 1.9.2.0<BR>JMJ\Mark on MARKDEV<BR>4.05.34.16 (04/05/2006) &lt;Client PB Code&gt; &gt;&gt;&gt; u_sqlca - (check()) SQL ERROR = (2627) SQLSTATE = 23000<BR>Microsoft OLE DB Provider for SQL Server<BR>Violation of PRIMARY KEY constraint 'PK_p_Patient_Encounter_1__12'. Cannot insert duplicate key in object 'p_Patient_Encounter'.<BR></P><P>&nbsp;</P></p><h3>Cause</h3><p><P>EncounterPRO requires that each encounter for a patient have a unique encounter_id value.&nbsp; Version 4 generates unique values for every encounter so there's not a problem.&nbsp; However, version 2 starts numbering encounter_id with 1 for each patient, so encounters for different patients may have the same encounter_id values.&nbsp; The version 4 merge function would have a problem when trying to merge patients that were migrated from version 2.</P></p><h3>Workaround</h3><p><P>The migration stored procedure has been updated to recognize when there are encounter_id conficts and to renumber the encounter_id values as needed during the merge.&nbsp; This enhancement is part of Mod Level 127, and is available to Mod Level 126 by installing Hotfix 125.</P></p><h3>Resolution</h3><p>This issue has been resolved in Mod Level 127.</p><h3>Notes</h3><p></p>