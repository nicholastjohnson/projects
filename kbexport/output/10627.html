<h1>EncounterPRO Freezes</h1><h2>10627</h2><h3>Introduction</h3><p>EncounterPRO uses a Relational Database Management System to store andretrieve all of its data.&nbsp; This RDBMS manages concurrent access toindividual data elements with a system of locks.&nbsp; These locksprevent users from accessing data which is currently being updated byother users.&nbsp; Occasionally, a process will lock some data and thenbe held up for some reason.&nbsp; When this happens then otherprocesses will wait for the lock to be released and may appear to theusers as EncounterPRO freezing up, often on multiple computers at thesame time.<br></p><h3>Symptom</h3><p><br></p><h3>Cause</h3><p><br></p><h3>Workaround</h3><p>In a query window, set the output type to "Results In Text" and run the following query:<br><br>EXECUTE sp_blocker_pss80<br><br>If you get the error "Could not find stored procedure'sp_blocker_pss80'" the run the defintion script below to define thestored procedure.<br><br>When you see the results, scroll the results pane down until you see the title "SPIDs at the head of blocking chains"<br><br>For the top number listed under that title, issue the following query:<br><br>KILL &lt;spid&gt;<spid><br><br>Where you substitue the actual spid number for &lt;spid&gt;<spid>.<br><br>The go back up to the EXECUTE sp_blocker_pss80 step and repeat until nospids are listed under the "SPIDs at the head of blocking chains" title.<br></spid></spid></p><h3>Resolution</h3><p><br></p><h3>Notes</h3><p>-- Definition Script for sp_blocker_pss80<br><br><pre class="code">use master<br>GO<br>if exists (select * from sysobjects where id = object_id('dbo.sp_blocker_pss80') and sysstat &amp; 0xf = 4)<br>   drop procedure dbo.sp_blocker_pss80<br>GO<br>create procedure dbo.sp_blocker_pss80 (@latch int = 0, @fast int = 1, @appname sysname='PSSDIAG')<br>as <br>--version 17SP3<br>if is_member('sysadmin')=0 <br>begin<br>  print 'Must be a member of the sysadmin group in order to run this procedure'<br>  return<br>end<br><br>set nocount on<br>SET LANGUAGE 'us_english'<br>declare @spid varchar(6)<br>declare @blocked varchar(6)<br>declare @time datetime<br>declare @time2 datetime<br>declare @dbname nvarchar(128)<br>declare @status sql_variant<br>declare @useraccess sql_variant<br><br>set @time = getdate()<br>declare @probclients table(spid smallint, ecid smallint, blocked smallint, waittype binary(2), dbid smallint,<br>   ignore_app tinyint, primary key (blocked, spid, ecid))<br>insert @probclients select spid, ecid, blocked, waittype, dbid,<br>   case when convert(varchar(128),hostname) = @appname then 1 else 0 end<br>   from master.dbo.sysprocesses where blocked!=0 or waittype != 0x0000<br><br>if exists (select spid from @probclients where ignore_app != 1 or waittype != 0x020B)<br>begin<br>   set @time2 = getdate()<br>   print ''<br>   print '8.2 Start time: ' + convert(varchar(26), @time, 121) + ' ' + convert(varchar(12), datediff(ms,@time,@time2))<br><br>   insert @probclients select distinct blocked, 0, 0, 0x0000, 0, 0 from @probclients<br>      where blocked not in (select spid from @probclients) and blocked != 0<br><br>   if (@fast = 1)<br>   begin<br>      print ''<br>      print 'SYSPROCESSES ' + ISNULL (@@servername,'(null)') + ' ' + str(@@microsoftversion)<br><br>      select spid, status, blocked, open_tran, waitresource, waittype, <br>         waittime, cmd, lastwaittype, cpu, physical_io,<br>         memusage, last_batch=convert(varchar(26), last_batch,121),<br>         login_time=convert(varchar(26), login_time,121),net_address,<br>         net_library, dbid, ecid, kpid, hostname, hostprocess,<br>         loginame, program_name, nt_domain, nt_username, uid, sid,<br>         sql_handle, stmt_start, stmt_end<br>      from master.dbo.sysprocesses<br>      where blocked!=0 or waittype != 0x0000<br>         or spid in (select blocked from @probclients where blocked != 0)<br>         or spid in (select spid from @probclients where blocked != 0)<br><br>      print 'ESP ' + convert(varchar(12), datediff(ms,@time2,getdate())) <br><br>      print ''<br>      print 'SYSPROC FIRST PASS'<br>      select spid, ecid, waittype from @probclients where waittype != 0x0000<br><br>      if exists(select blocked from @probclients where blocked != 0)<br>      begin<br>         print 'Blocking via locks at ' + convert(varchar(26), @time, 121)<br>         print ''<br>         print 'SPIDs at the head of blocking chains'<br>         select spid from @probclients<br>            where blocked = 0 and spid in (select blocked from @probclients where spid != 0)<br>         if @latch = 0<br>         begin<br>            print 'SYSLOCKINFO'<br>            select @time2 = getdate()<br><br>            select spid = convert (smallint, req_spid),<br>               ecid = convert (smallint, req_ecid),<br>               rsc_dbid As dbid,<br>               rsc_objid As ObjId,<br>               rsc_indid As IndId,<br>               Type = case rsc_type when 1 then 'NUL'<br>                                    when 2 then 'DB'<br>                                    when 3 then 'FIL'<br>                                    when 4 then 'IDX'<br>                                    when 5 then 'TAB'<br>                                    when 6 then 'PAG'<br>                                    when 7 then 'KEY'<br>                                    when 8 then 'EXT'<br>                                    when 9 then 'RID'<br>                                    when 10 then 'APP' end,<br>               Resource = substring (rsc_text, 1, 16),<br>               Mode = case req_mode + 1 when 1 then NULL<br>                                        when 2 then 'Sch-S'<br>                                        when 3 then 'Sch-M'<br>                                        when 4 then 'S'<br>                                        when 5 then 'U'<br>                                        when 6 then 'X'<br>                                        when 7 then 'IS'<br>                                        when 8 then 'IU'<br>                                        when 9 then 'IX'<br>                                        when 10 then 'SIU'<br>                                        when 11 then 'SIX'<br>                                        when 12 then 'UIX'<br>                                        when 13 then 'BU'<br>                                        when 14 then 'RangeS-S'<br>                                        when 15 then 'RangeS-U'<br>                                        when 16 then 'RangeIn-Null'<br>                                        when 17 then 'RangeIn-S'<br>                                        when 18 then 'RangeIn-U'<br>                                        when 19 then 'RangeIn-X'<br>                                        when 20 then 'RangeX-S'<br>                                        when 21 then 'RangeX-U'<br>                                        when 22 then 'RangeX-X'end,<br>               Status = case req_status when 1 then 'GRANT'<br>                                        when 2 then 'CNVT'<br>                                        when 3 then 'WAIT' end,<br>               req_transactionID As TransID, req_transactionUOW As TransUOW<br>            from master.dbo.syslockinfo s,<br>               @probclients p<br>            where p.spid = s.req_spid<br><br>            print 'ESL ' + convert(varchar(12), datediff(ms,@time2,getdate())) <br>         end -- latch not set<br>      end<br>      else<br>         print 'No blocking via locks at ' + convert(varchar(26), @time, 121)<br>      print ''<br>   end  -- fast set<br><br>   else  <br>   begin  -- Fast not set<br>      print ''<br>      print 'SYSPROCESSES ' + ISNULL (@@servername,'(null)') + ' ' + str(@@microsoftversion)<br><br>      select spid, status, blocked, open_tran, waitresource, waittype, <br>         waittime, cmd, lastwaittype, cpu, physical_io,<br>         memusage, last_batch=convert(varchar(26), last_batch,121),<br>         login_time=convert(varchar(26), login_time,121),net_address,<br>         net_library, dbid, ecid, kpid, hostname, hostprocess,<br>         loginame, program_name, nt_domain, nt_username, uid, sid,<br>         sql_handle, stmt_start, stmt_end<br>      from master.dbo.sysprocesses<br><br>      print 'ESP ' + convert(varchar(12), datediff(ms,@time2,getdate())) <br><br>      print ''<br>      print 'SYSPROC FIRST PASS'<br>      select spid, ecid, waittype from @probclients where waittype != 0x0000<br><br>      if exists(select blocked from @probclients where blocked != 0)<br>      begin<br>         print 'Blocking via locks at ' + convert(varchar(26), @time, 121)<br>         print ''<br>         print 'SPIDs at the head of blocking chains'<br>         select spid from @probclients<br>         where blocked = 0 and spid in (select blocked from @probclients where spid != 0)<br>         if @latch = 0<br>         begin<br>            print 'SYSLOCKINFO'<br>            select @time2 = getdate()<br><br>            select spid = convert (smallint, req_spid),<br>               ecid = convert (smallint, req_ecid),<br>               rsc_dbid As dbid,<br>               rsc_objid As ObjId,<br>               rsc_indid As IndId,<br>               Type = case rsc_type when 1 then 'NUL'<br>                                    when 2 then 'DB'<br>                                    when 3 then 'FIL'<br>                                    when 4 then 'IDX'<br>                                    when 5 then 'TAB'<br>                                    when 6 then 'PAG'<br>                                    when 7 then 'KEY'<br>                                    when 8 then 'EXT'<br>                                    when 9 then 'RID'<br>                                    when 10 then 'APP' end,<br>               Resource = substring (rsc_text, 1, 16),<br>               Mode = case req_mode + 1 when 1 then NULL<br>                                        when 2 then 'Sch-S'<br>                                        when 3 then 'Sch-M'<br>                                        when 4 then 'S'<br>                                        when 5 then 'U'<br>                                        when 6 then 'X'<br>                                        when 7 then 'IS'<br>                                        when 8 then 'IU'<br>                                        when 9 then 'IX'<br>                                        when 10 then 'SIU'<br>                                        when 11 then 'SIX'<br>                                        when 12 then 'UIX'<br>                                        when 13 then 'BU'<br>                                        when 14 then 'RangeS-S'<br>                                        when 15 then 'RangeS-U'<br>                                        when 16 then 'RangeIn-Null'<br>                                        when 17 then 'RangeIn-S'<br>                                        when 18 then 'RangeIn-U'<br>                                        when 19 then 'RangeIn-X'<br>                                        when 20 then 'RangeX-S'<br>                                        when 21 then 'RangeX-U'<br>                                        when 22 then 'RangeX-X'end,<br>               Status = case req_status when 1 then 'GRANT'<br>                                        when 2 then 'CNVT'<br>                                        when 3 then 'WAIT' end,<br>               req_transactionID As TransID, req_transactionUOW As TransUOW<br>            from master.dbo.syslockinfo<br><br>            print 'ESL ' + convert(varchar(12), datediff(ms,@time2,getdate())) <br>         end -- latch not set<br>      end<br>      else<br>        print 'No blocking via locks at ' + convert(varchar(26), @time, 121)<br>      print ''<br>   end -- Fast not set<br><br>   print 'DBCC SQLPERF(WAITSTATS)'<br>   dbcc sqlperf(waitstats)<br><br>   Print ''<br>   Print '*********************************************************************'<br>   Print 'Print out DBCC Input buffer for all blocked or blocking spids.'<br>   Print '*********************************************************************'<br><br>   declare ibuffer cursor fast_forward for<br>   select distinct cast (spid as varchar(6)) as spid<br>   from @probclients<br>   where (spid &lt;&gt; @@spid) and <br>      ((blocked!=0 or (waittype != 0x0000 and ignore_app = 0))<br>      or spid in (select blocked from @probclients where blocked != 0))<br>   open ibuffer<br>   fetch next from ibuffer into @spid<br>   while (@@fetch_status != -1)<br>   begin<br>      print ''<br>      print 'DBCC INPUTBUFFER FOR SPID ' + @spid<br>      exec ('dbcc inputbuffer (' + @spid + ')')<br><br>      fetch next from ibuffer into @spid<br>   end<br>   deallocate ibuffer<br><br>   Print ''<br>   Print '*******************************************************************************'<br>   Print 'Print out DBCC OPENTRAN for active databases for all blocked or blocking spids.'<br>   Print '*******************************************************************************'<br>   declare ibuffer cursor fast_forward for<br>   select distinct cast (dbid as varchar(6)) from @probclients<br>   where dbid != 0<br>   open ibuffer<br>   fetch next from ibuffer into @spid<br>   while (@@fetch_status != -1)<br>   begin<br>      print ''<br>      set @dbname = db_name(@spid)<br>      set @status = DATABASEPROPERTYEX(@dbname,'Status')<br>      set @useraccess = DATABASEPROPERTYEX(@dbname,'UserAccess')<br>      print 'DBCC OPENTRAN FOR DBID ' + @spid + ' ['+ @dbname + ']'<br>      if @status = N'ONLINE' and @useraccess != N'SINGLE_USER'<br>         dbcc opentran(@dbname)<br>      else<br>         print 'Skipped: Status=' + convert(nvarchar(128),@status)<br>            + ' UserAccess=' + convert(nvarchar(128),@useraccess)<br><br>      print ''<br>      if @spid = '2' select @blocked = 'Y'<br>      fetch next from ibuffer into @spid<br>   end<br>   deallocate ibuffer<br>   if @blocked != 'Y' <br>   begin<br>      print ''<br>      print 'DBCC OPENTRAN FOR DBID  2 [tempdb]'<br>      dbcc opentran ('tempdb')<br>   end<br><br>   print 'End time: ' + convert(varchar(26), getdate(), 121)<br>end -- All<br>else<br>  print '8 No Waittypes: ' + convert(varchar(26), @time, 121) + ' ' <br>     + convert(varchar(12), datediff(ms,@time,getdate())) + ' ' + ISNULL (@@servername,'(null)')<br>GO    <br><br>create procedure dbo.sp_blocker_pss80 (@latch int = 0, @fast int = 1, @appname sysname='PSSDIAG')<br>as <br>--version 17<br>if is_member('sysadmin')=0<br>begin<br>  print 'Must be a member of the sysadmin group in order to run this procedure'<br>  return<br>end<br><br>set nocount on<br>declare @spid varchar(6)<br>declare @blocked varchar(6)<br>declare @time datetime<br>declare @time2 datetime<br>declare @dbname nvarchar(128)<br>declare @status sql_variant<br>declare @useraccess sql_variant<br><br>set @time = getdate()<br>declare @probclients table(spid smallint, ecid smallint, blocked smallint, waittype binary(2), dbid smallint,<br>   ignore_app tinyint, primary key (blocked, spid, ecid))<br>insert @probclients select spid, ecid, blocked, waittype, dbid,<br>   case when convert(varchar(128),hostname) = @appname then 1 else 0 end<br>   from master.dbo.sysprocesses where blocked!=0 or waittype != 0x0000<br><br>if exists (select spid from @probclients where ignore_app != 1 or waittype != 0x020B)<br>begin<br>   set @time2 = getdate()<br>   print ''<br>   print '8 Start time: ' + convert(varchar(26), @time, 121) + ' ' + convert(varchar(12), datediff(ms,@time,@time2))<br><br>   insert @probclients select distinct blocked, 0, 0, 0x0000, 0, 0 from @probclients<br>      where blocked not in (select spid from @probclients) and blocked != 0<br><br>   if (@fast = 1)<br>   begin<br>      print ''<br>      print 'SYSPROCESSES ' + ISNULL (@@servername,'(null)') + ' ' + str(@@microsoftversion)<br><br>      select spid, status, blocked, open_tran, waitresource, waittype, <br>         waittime, cmd, lastwaittype, cpu, physical_io,<br>         memusage,last_batch=convert(varchar(26), last_batch,121),<br>         login_time=convert(varchar(26), login_time,121), net_address,<br>         net_library, dbid, ecid, kpid, hostname, hostprocess,<br>         loginame, program_name, nt_domain, nt_username, uid, sid<br>      from master.dbo.sysprocesses<br>      where blocked!=0 or waittype != 0x0000<br>         or spid in (select blocked from @probclients where blocked != 0)<br>         or spid in (select spid from @probclients where waittype != 0x0000)<br><br>      print 'ESP ' + convert(varchar(12), datediff(ms,@time2,getdate())) <br><br>      print ''<br>      print 'SYSPROC FIRST PASS'<br>      select spid, ecid, waittype from @probclients where waittype != 0x0000<br><br>      if exists(select blocked from @probclients where blocked != 0)<br>      begin<br>         print 'Blocking via locks at ' + convert(varchar(26), @time, 121)<br>         print ''<br>         print 'SPIDs at the head of blocking chains'<br>         select spid from @probclients<br>            where blocked = 0 and spid in (select blocked from @probclients where spid != 0)<br>         if @latch = 0<br>         begin<br>            print 'SYSLOCKINFO'<br>            select @time2 = getdate()<br><br>            select spid = convert (smallint, req_spid),<br>               ecid = convert (smallint, req_ecid),<br>               rsc_dbid As dbid,<br>               rsc_objid As ObjId,<br>               rsc_indid As IndId,<br>               Type = case rsc_type when 1 then 'NUL'<br>                                    when 2 then 'DB'<br>                                    when 3 then 'FIL'<br>                                    when 4 then 'IDX'<br>                                    when 5 then 'TAB'<br>                                    when 6 then 'PAG'<br>                                    when 7 then 'KEY'<br>                                    when 8 then 'EXT'<br>                                    when 9 then 'RID'<br>                                    when 10 then 'APP' end,<br>               Resource = substring (rsc_text, 1, 16),<br>               Mode = case req_mode + 1 when 1 then NULL<br>                                        when 2 then 'Sch-S'<br>                                        when 3 then 'Sch-M'<br>                                        when 4 then 'S'<br>                                        when 5 then 'U'<br>                                        when 6 then 'X'<br>                                        when 7 then 'IS'<br>                                        when 8 then 'IU'<br>                                        when 9 then 'IX'<br>                                        when 10 then 'SIU'<br>                                        when 11 then 'SIX'<br>                                        when 12 then 'UIX'<br>                                        when 13 then 'BU'<br>                                        when 14 then 'RangeS-S'<br>                                        when 15 then 'RangeS-U'<br>                                        when 16 then 'RangeIn-Null'<br>                                        when 17 then 'RangeIn-S'<br>                                        when 18 then 'RangeIn-U'<br>                                        when 19 then 'RangeIn-X'<br>                                        when 20 then 'RangeX-S'<br>                                        when 21 then 'RangeX-U'<br>                                        when 22 then 'RangeX-X'end,<br>               Status = case req_status when 1 then 'GRANT'<br>                                        when 2 then 'CNVT'<br>                                        when 3 then 'WAIT' end,<br>               req_transactionID As TransID, req_transactionUOW As TransUOW<br>            from master.dbo.syslockinfo s,<br>               @probclients p<br>            where p.spid = s.req_spid<br><br>            print 'ESL ' + convert(varchar(12), datediff(ms,@time2,getdate())) <br>         end -- latch not set<br>      end<br>      else<br>         print 'No blocking via locks at ' + convert(varchar(26), @time, 121)<br>      print ''<br>   end  -- fast set<br><br>   else  <br>   begin  -- Fast not set<br>      print ''<br>      print 'SYSPROCESSES ' + ISNULL (@@servername,'(null)') + ' ' + str(@@microsoftversion)<br><br>      select spid, status, blocked, open_tran, waitresource, waittype, <br>         waittime, cmd, lastwaittype, cpu, physical_io,<br>         memusage,last_batch=convert(varchar(26), last_batch,121),<br>         login_time=convert(varchar(26), login_time,121), net_address,<br>         net_library, dbid, ecid, kpid, hostname, hostprocess,<br>         loginame, program_name, nt_domain, nt_username, uid, sid<br>      from master.dbo.sysprocesses<br><br>      print 'ESP ' + convert(varchar(12), datediff(ms,@time2,getdate())) <br><br>      print ''<br>      print 'SYSPROC FIRST PASS'<br>      select spid, ecid, waittype from @probclients where waittype != 0x0000<br><br>      if exists(select blocked from @probclients where blocked != 0)<br>      begin<br>         print 'Blocking via locks at ' + convert(varchar(26), @time, 121)<br>         print ''<br>         print 'SPIDs at the head of blocking chains'<br>         select spid from @probclients<br>         where blocked = 0 and spid in (select blocked from @probclients where spid != 0)<br>         if @latch = 0<br>         begin<br>            print 'SYSLOCKINFO'<br>            select @time2 = getdate()<br><br>            select spid = convert (smallint, req_spid),<br>               ecid = convert (smallint, req_ecid),<br>               rsc_dbid As dbid,<br>               rsc_objid As ObjId,<br>               rsc_indid As IndId,<br>               Type = case rsc_type when 1 then 'NUL'<br>                                    when 2 then 'DB'<br>                                    when 3 then 'FIL'<br>                                    when 4 then 'IDX'<br>                                    when 5 then 'TAB'<br>                                    when 6 then 'PAG'<br>                                    when 7 then 'KEY'<br>                                    when 8 then 'EXT'<br>                                    when 9 then 'RID'<br>                                    when 10 then 'APP' end,<br>               Resource = substring (rsc_text, 1, 16),<br>               Mode = case req_mode + 1 when 1 then NULL<br>                                        when 2 then 'Sch-S'<br>                                        when 3 then 'Sch-M'<br>                                        when 4 then 'S'<br>                                        when 5 then 'U'<br>                                        when 6 then 'X'<br>                                        when 7 then 'IS'<br>                                        when 8 then 'IU'<br>                                        when 9 then 'IX'<br>                                        when 10 then 'SIU'<br>                                        when 11 then 'SIX'<br>                                        when 12 then 'UIX'<br>                                        when 13 then 'BU'<br>                                        when 14 then 'RangeS-S'<br>                                        when 15 then 'RangeS-U'<br>                                        when 16 then 'RangeIn-Null'<br>                                        when 17 then 'RangeIn-S'<br>                                        when 18 then 'RangeIn-U'<br>                                        when 19 then 'RangeIn-X'<br>                                        when 20 then 'RangeX-S'<br>                                        when 21 then 'RangeX-U'<br>                                        when 22 then 'RangeX-X'end,<br>               Status = case req_status when 1 then 'GRANT'<br>                                        when 2 then 'CNVT'<br>                                        when 3 then 'WAIT' end,<br>               req_transactionID As TransID, req_transactionUOW As TransUOW<br>            from master.dbo.syslockinfo<br><br>            print 'ESL ' + convert(varchar(12), datediff(ms,@time2,getdate())) <br>         end -- latch not set<br>      end<br>      else<br>        print 'No blocking via locks at ' + convert(varchar(26), @time, 121)<br>      print ''<br>   end -- Fast not set<br><br>   print 'DBCC SQLPERF(WAITSTATS)'<br>   dbcc sqlperf(waitstats)<br><br>   Print ''<br>   Print '*********************************************************************'<br>   Print 'Print out DBCC Input buffer for all blocked or blocking spids.'<br>   Print '*********************************************************************'<br><br>   declare ibuffer cursor fast_forward for<br>   select distinct cast (spid as varchar(6)) as spid<br>   from @probclients<br>   where (spid &lt;&gt; @@spid) and <br>      ((blocked!=0 or (waittype != 0x0000 and ignore_app = 0))<br>      or spid in (select blocked from @probclients where blocked != 0))<br>   open ibuffer<br>   fetch next from ibuffer into @spid<br>   while (@@fetch_status != -1)<br>   begin<br>      print ''<br>      print 'DBCC INPUTBUFFER FOR SPID ' + @spid<br>      exec ('dbcc inputbuffer (' + @spid + ')')<br><br>      fetch next from ibuffer into @spid<br>   end<br>   deallocate ibuffer<br><br>   Print ''<br>   Print '*******************************************************************************'<br>   Print 'Print out DBCC OPENTRAN for active databases for all blocked or blocking spids.'<br>   Print '*******************************************************************************'<br>   declare ibuffer cursor fast_forward for<br>   select distinct cast (dbid as varchar(6)) from @probclients<br>   where dbid != 0<br>   open ibuffer<br>   fetch next from ibuffer into @spid<br>   while (@@fetch_status != -1)<br>   begin<br>      print ''<br>      set @dbname = db_name(@spid)<br>      set @status = DATABASEPROPERTYEX(@dbname,'Status')<br>      set @useraccess = DATABASEPROPERTYEX(@dbname,'UserAccess')<br>      print 'DBCC OPENTRAN FOR DBID ' + @spid + ' ['+ @dbname + ']'<br>      if @status = N'ONLINE' and @useraccess != N'SINGLE_USER'<br>         dbcc opentran(@dbname)<br>      else<br>         print 'Skipped: Status=' + convert(nvarchar(128),@status)<br>            + ' UserAccess=' + convert(nvarchar(128),@useraccess)<br><br>      print ''<br>      if @spid = '2' select @blocked = 'Y'<br>      fetch next from ibuffer into @spid<br>   end<br>   deallocate ibuffer<br>   if @blocked != 'Y' <br>   begin<br>      print ''<br>      print 'DBCC OPENTRAN FOR DBID  2 [tempdb]'<br>      dbcc opentran ('tempdb')<br>   end<br><br>   print 'End time: ' + convert(varchar(26), getdate(), 121)<br>end -- All<br>else<br>  print '8 No Waittypes: ' + convert(varchar(26), @time, 121) + ' '<br>     + convert(varchar(12), datediff(ms,@time,getdate())) + ' ' + ISNULL (@@servername,'(null)')<br>GO</pre><br></p>