<h1>Close Old Encounters</h1><h2>10645</h2><h3>Introduction</h3><p>This script closes&nbsp;all encounters before a certain date</p><h3>Symptom</h3><p></p><h3>Cause</h3><p></p><h3>Workaround</h3><p></p><h3>Resolution</h3><p><P>&nbsp;</P><P>------------------------------------------------------------------------------<BR>------------------------------------------------------------------------------<BR>-- This script loops through the specified patient encounters<BR>-- and closes them.&nbsp; The items to close are specified in the<BR>-- cursor declare WHERE clause.&nbsp; The closing status is set in the next line<BR>-- after the cursor declare<BR>------------------------------------------------------------------------------<BR>------------------------------------------------------------------------------</P><P><BR>DECLARE @ls_cpr_id varchar(12),<BR>&nbsp;&nbsp;@ll_encounter_id int,<BR>&nbsp;&nbsp;@ls_progress_type varchar(24),<BR>&nbsp;&nbsp;@ls_progress_key varchar(40),<BR>&nbsp;&nbsp;@ls_progress varchar(255)</P><P>DECLARE lc_items CURSOR LOCAL FAST_FORWARD FOR<BR>&nbsp;SELECT cpr_id, encounter_id<BR>&nbsp;FROM p_Patient_Encounter<BR>&nbsp;WHERE encounter_status = 'OPEN'<BR>&nbsp;AND encounter_date &lt; CAST('8/1/2003' AS datetime)<BR>&nbsp;<BR>SET @ls_progress_type = 'CLOSED'<BR>SET @ls_progress_key = NULL<BR>SET @ls_progress = NULL</P><P>OPEN lc_items</P><P>FETCH lc_items INTO @ls_cpr_id, @ll_encounter_id<BR>WHILE @@FETCH_STATUS = 0<BR>&nbsp;BEGIN<BR>&nbsp;EXECUTE sp_Set_Encounter_Progress<BR>&nbsp;&nbsp;@ps_cpr_id = @ls_cpr_id,<BR>&nbsp;&nbsp;@pl_encounter_id = @ll_encounter_id,<BR>&nbsp;&nbsp;@ps_progress_type = @ls_progress_type,<BR>&nbsp;&nbsp;@ps_progress_key = @ls_progress_key,<BR>&nbsp;&nbsp;@ps_progress = @ls_progress,<BR>&nbsp;&nbsp;@ps_user_id = '#SYSTEM',<BR>&nbsp;&nbsp;@ps_created_by = '#SYSTEM'</P><P>&nbsp;FETCH lc_items INTO @ls_cpr_id, @ll_encounter_id<BR>&nbsp;END</P><P>CLOSE lc_items<BR>DEALLOCATE lc_items</P><P><BR>&nbsp;</P></p><h3>Notes</h3><p></p>